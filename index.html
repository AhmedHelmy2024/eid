function previewImage() {
  var selectedImage = document.getElementById("imageSelect").value;
  var name = document.getElementById("nameInput").value;
  var previewDiv = document.getElementById("preview");

  var img = new Image();
  img.onload = function() {
    var maxWidth = 400; // تعيين العرض الأقصى للمعاينة والصورة المحمّلة
    var maxHeight = 400; // تعيين الارتفاع الأقصى للمعاينة والصورة المحمّلة
    var width = img.width;
    var height = img.height;

    if (width > height) {
      if (width > maxWidth) {
        height *= maxWidth / width;
        width = maxWidth;
      }
    } else {
      if (height > maxHeight) {
        width *= maxHeight / height;
        height = maxHeight;
      }
    }

    var canvas = document.createElement("canvas");
    canvas.width = width;
    canvas.height = height;
    var ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0, width, height);
    ctx.font = "36px Arial"; // تعيين حجم الخط للنص
    ctx.fillStyle = "#00b1e1"; // تعيين لون النص
    ctx.textAlign = "center";
    ctx.fillText(name, width / 2, height - 20); // ضبط موضع النص

    previewDiv.innerHTML = "";
    previewDiv.appendChild(canvas);
  };
  img.src = selectedImage;
}

function downloadImage() {
  var previewDiv = document.getElementById("preview");
  var canvas = previewDiv.querySelector("canvas");
  var name = document.getElementById("nameInput").value;

  var downloadLink = document.createElement("a");
  downloadLink.download = "edited_image.png";
  downloadLink.href = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
  downloadLink.click();
}
